const incomeChart = document.querySelector("#income-chart");
const expenseChart = document.querySelector("#expense-chart");
const incomeBar = document.querySelector("#budget-trend");


const colors =[
"#9FE2BF",
"#53BDAS",
"#F5C26B",
"#CBD6E2",
"#4FB06D",
"#CAE7D3",
"#5C62D6",
"#EBB8DD",
]
//
const getIncomeItems = async (user_id) => {
  try {
    const response = await fetch(`/api/revenue/${user_id}/`, {
      method: "GET",
      headers: { "Content-Type": "application/json" },
    });
    
    return response;
  } catch (error) {
    console.log(error);
  }
};

const income= getIncomeItems.
console.log(response)
renderIncomepie(income)
//render income chart // you need the data in here
const renderIncomepie= async({incomeUserData,categoryArray,incomeArrayPer})=> {
  const labels =categoryArray
  const values = incomeArrayPer;
  const chartData = {
  labels:labels, //req.body.monthlyexpense
  new Chart (chart1, {
      type: "pie",
      data: {
          labels: xValues,
          datasets: [
          {
              backgroundColor: barColors,
              data: yValues,
          },
          ],
      },
      const incomeChartVar = new Chart(incomeChart, {
        type: "pie",
        data: chartData,
      });
  })}
};

//render expense chart // you need the data in here
const renderIncomeChart = async (data) => {
  const labels = Object.keys(data.totals);
  const values = Object.values(data.totals);
  const chartData = {
    labels: labels,
    datasets: [
      {
        data: values,
        backgroundColor: colors,
        hoverBackgroundColor: colors,
      },
    ],
  };
  const incomeChartVar = new Chart(incomeChart, {
    type: "pie",
    data: chartData,
  });
};

//render expense chart // you need the data in here
const renderExpenseChart = async (data) => {
  const labels = Object.keys(data.totals);
  const values = Object.values(data.totals);
  const chartData = {
    labels: labels,
    datasets: [
      {
        data: values,
        backgroundColor: colors,
        hoverBackgroundColor: colors,
      },
    ],
  };
  const expenseChartVar = new Chart( expenseChart, {
    type: "line",
    data: chartData,
  });
};
// 





// dont look at this at this moment

//May not need the below code  
const getExpenseItems = async (user_id) => {
  try {
    const response = await fetch(`/api/expense/${user_id}/`, {
      method: "GET",
      headers: { "Content-Type": "application/json" },
    });
    return response;
  } catch (error) {
    console.log(error);
  }
};


const getSession = async () => {
  try {
    const response = await fetch("/api/session/current", {
      method: "GET",
      headers: { "Content-Type": "application/json" },
    });
    if (response.ok) {
      const data = await response.json();
      return data;
    }
  } catch (error) {
    console.log(error);
  }
};


//getting data for charts
const calculateCategoryTotals = async (data) => {
  const categoryTotals = {};
  let totalAmount = 0;

  for (const item of data) {
    const { category, amount } = item;
    totalAmount += amount;
    categoryTotals[category] = (categoryTotals[category] || 0) + amount;
  }

  const categoryPercentages = {};
  for (const category in categoryTotals) {
    const percentage = (categoryTotals[category] / totalAmount) * 100;
    categoryPercentages[category] = percentage.toFixed(2);
  }

  return {
    totals: categoryTotals,
    percentages: categoryPercentages,
  };
};






const init = async () => {
  const session = await getSession();
  const budgetData = await requestHandler(session.user_id, session.budget_id);
  const incomeCategoryData = await calculateCategoryTotals(budgetData.dataOne);
  const expenseCategoryData = await calculateCategoryTotals(budgetData.dataTwo);
  const budget = budgetData.dataThree;
  await renderIncomeChart(incomeCategoryData);
  await renderExpenseChart(expenseCategoryData);
  await renderIncomeBar(incomeCategoryData); 
  await renderExpenseBar(expenseCategoryData);
  await renderTable();
};

document.addEventListener("DOMContentLoaded", async function () {
  init();
});
